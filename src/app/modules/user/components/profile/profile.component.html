<div class="container align-items-center pt-5 w-75">
  <mat-card appearance="outlined">
    <mat-card-title class="text-center pt-3"><h4>Mój profil</h4></mat-card-title>
    <form *ngIf="profileForm && userResponse" [formGroup]="profileForm" (ngSubmit)="onUpdate()">
    <mat-card-content class="px-3 px-md-5">
        <mat-accordion>
            <mat-expansion-panel class="disabled" hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title> Imię i nazwisko </mat-panel-title>
                <mat-panel-description> {{userResponse.name}}  {{userResponse.surname}} </mat-panel-description>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Email </mat-panel-title>
                <mat-panel-description> {{userResponse.email}} </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Podaj nowy adres email</mat-label>
                <input
                  id="new-email-patient-aurorum"
                  matInput
                  [formControl]="controls.email" />
                @if (controls.email.invalid) {
                  <mat-error>{{ getErrorMessage(controls.email) }}</mat-error>
                }
              </mat-form-field>
            </mat-expansion-panel>
            <mat-expansion-panel class="disabled" hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title> PESEL </mat-panel-title>
                <mat-panel-description>
                  <span *ngIf="userResponse.pesel">{{userResponse.pesel}}</span>
                  <span *ngIf="!userResponse.pesel" class="badge bg-secondary">BRAK</span>
                </mat-panel-description>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
            <mat-expansion-panel class="disabled" hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title> Data urodzenia </mat-panel-title>
                <mat-panel-description> {{userResponse.birthDate | date:'dd-MM-yyyy'}} </mat-panel-description>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Numer telefonu </mat-panel-title>
                <mat-panel-description> {{userResponse.phoneNumber}} </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Podaj nowy numer telefonu</mat-label>
                <input
                  id="new-phone-number-patient-aurorum"
                  matInput
                  [formControl]="controls.phoneNumber" />
                @if (controls.phoneNumber.invalid) {
                  <mat-error>{{ getErrorMessage(controls.phoneNumber) }}</mat-error>
                }
              </mat-form-field>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Weryfikacja dwuetapowa </mat-panel-title>
                <mat-panel-description>
                  <span *ngIf="userResponse.twoFactorAuth" class="badge bg-success">AKTYWNE</span>
                  <span *ngIf="!userResponse.twoFactorAuth" class="badge bg-warning">NIEAKTYWNE</span>
                </mat-panel-description>
              </mat-expansion-panel-header>
              <p>ZAŁÓŻ WERYFIKACJE DWUETAPOWA</p>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Newsletter</mat-panel-title>
                <mat-panel-description>
                  <span *ngIf="userResponse.newsletter" class="badge bg-success">DOŁĄCZONO</span>
                  <span *ngIf="!userResponse.newsletter" class="badge bg-secondary">NIE DOŁĄCZONO</span>
                </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-checkbox [formControl]="controls.newsletter">
                Chęć uczestniczenia w newsletterze
              </mat-checkbox>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Preferencje komunikacyjne </mat-panel-title>
                <mat-panel-description> {{getCommunicationPreferenceLabel(userResponse.communicationPreferences)}} </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-form-field>
                <mat-select [formControl]="controls.communicationPreferences">
                  <mat-option [value]="communicationPreferences.EMAIL">Email</mat-option>
                  <mat-option [value]="communicationPreferences.PHONE_NUMBER">Telefon</mat-option>
                </mat-select>
              </mat-form-field>
            </mat-expansion-panel>
            <mat-expansion-panel>
              <mat-expansion-panel-header>
                <mat-panel-title> Usunięcie konta </mat-panel-title>
              </mat-expansion-panel-header>
              <button mat-raised-button (click)="openDeleteDialog()">USUŃ KONTO</button>
            </mat-expansion-panel>
      </mat-accordion>
    </mat-card-content>
      <mat-card-actions class="d-flex justify-content-between mt-4">
        <button mat-stroked-button type="button" (click)="onClear()">
          Wyczyść
        </button>
        <button mat-flat-button class="btn text-white border-0" style="background-color: var(--primary-purple)" type="submit" [disabled]="!isFormChanged || profileForm.invalid">
          Zaktualizuj
        </button>
      </mat-card-actions>
    </form>
    <app-alert class="mt-3 w-75 m-auto" *ngIf="infoMessage()" [text]="infoMessage()" [variant]="variant()"></app-alert>
  </mat-card>
</div>
