<div class="container-fluid py-3 min-vh-100">
  <h2 class="text-center pb-4">Profil pacjenta</h2>
  <div class="row g-4">

      <div *ngIf="patient" class="col-lg-4 col-xl-3">
        <div class="card  border rounded-2 sticky-top" style="top: 20px; z-index: 100;">
          <div class="card-body text-center p-4">

            <h4 class="card-title mb-1">{{ patient.name }} {{ patient.surname }}</h4>
            <p class="text-muted small mb-4">{{ patient.email }}</p>

            <ul class="list-group list-group-flush text-start mb-4">
              <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                <span class="text-muted">Telefon</span>
                <span class="fw-semibold">{{ patient.phoneNumber }}</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                <span class="text-muted">Data urodzenia</span>
                <span class="fw-semibold">{{ patient.birthDate | date: 'dd.MM.yyyy' }}</span>
              </li>
              @if (hasPesel()) {
                <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                  <span class="text-muted">PESEL</span>
                  <span class="fw-semibold">{{ patient.pesel || '-----' }}</span>
                </li>
              }
              <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                <span class="text-muted">Newsletter</span>
                <span class="badge rounded-pill" [ngClass]="patient.newsletter ? 'text-bg-success' : 'text-bg-secondary'">
                  {{ patient.newsletter ? 'Tak' : 'Nie' }}
                </span>
              </li>
            </ul>

            <div class="d-grid gap-2">
              <button mat-flat-button style="background-color: var(--primary-purple)" color="primary" class="w-100 py-2" (click)="updateData(patient.id)">
                Edytuj dane
              </button>
              <button mat-stroked-button class="w-100 py-2" routerLink="/internal/patients">
                Powrót do listy
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-8 col-xl-9">
        <div class="card border rounded-2">

          <div class="card-header bg-white border-0 pt-4 px-4 pb-2 d-flex flex-wrap justify-content-between align-items-center">
            <div>
              <h3 class="fw-semibold mb-1">Historia wizyt</h3>
              <p class="text-muted small mb-0">Przeglądaj wszystkie zaplanowane i zakończone wizyty</p>
            </div>

            <div class="mt-3 mt-md-0" style="width: 220px;">
              <mat-form-field appearance="outline" class="w-100 density-compact">
                <mat-label>Filtruj status</mat-label>
                <mat-select [formControl]="appointmentType">
                  @for (type of appointmentTypes; track type.key) {
                    <mat-option [value]="type.key">{{ type.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <div class="card-body p-4">

              <div *ngIf="appointments.length > 0" class="gap-3">
                <div *ngFor="let appointment of appointments">
                  <app-doctor-card
                    [id]="appointment.id"
                    [name]="appointment.doctor.name"
                    [surname]="appointment.doctor.surname"
                    [specialization]="appointment.doctor.specializations[0].name"
                    [date]="appointment.startedAt"
                    [price]="appointment.service.price"
                    [profilePicture]="appointment.doctor.profilePicture"
                    [serviceName]="appointment.service.name"
                    [paymentStatus]="appointment.payment.status"
                    [mode]="'visit'"
                    (click)="goToDetails(patient.id, appointment)"></app-doctor-card>
                </div>
              </div>

              <div class="mt-4 border-top pt-3">
                <mat-paginator [length]="totalData"
                               [pageSize]="5"
                               [pageSizeOptions]="[5, 10, 20]"
                               aria-label="Wybierz stronę">
                </mat-paginator>
              </div>

              <div *ngIf="appointments.length === 0" class="text-center py-5">
                <div class="mb-3 text-muted opacity-50">
                  <span class="material-icons" style="font-size: 4rem;">event_busy</span>
                </div>
                <h5 class="fw-normal text-muted">Brak wizyt o wybranym statusie</h5>
              </div>
          </div>
        </div>
      </div>

    </div>
</div>
