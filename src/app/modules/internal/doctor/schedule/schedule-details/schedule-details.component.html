<div class="container-fluid d-flex align-items-center pt-3 flex-column">
  <h2 class="text-center mb-4">
    Szczegóły grafiku
  </h2>
  <div class="card col-12 col-sm-10 col-md-8 col-lg-6 p-4 mx-auto border rounded-2">
    <form *ngIf="schedule() as app" [formGroup]="scheduleForm" class="d-flex flex-column align-items-center">

      <div class="mb-2 w-100">
        <div *ngIf="!editMode()" class="card p-2 mb-4 w-100">
          <h5 class="text-center">Usługi przypisane do grafiku</h5>
          <ul class="list-group mb-1 overflow-y-auto shadow-none border-0" style="max-height: 150px; scroll-behavior: smooth">
            <li *ngFor="let service of app.services" class="list-group-item border-0 shadow-none">
              {{ service.name }}
            </li>
          </ul>
        </div>

        <mat-form-field *ngIf="editMode()" appearance="outline" class="w-100">
          <mat-label>Serwisy</mat-label>
          <mat-select [formControl]="controls.services" multiple>
            @for (group of specializations; track group) {
              <mat-optgroup [label]="group.name">
                @for (services of group.services; track services) {
                  <mat-option [value]="services.id">{{services.name}}</mat-option>
                }
              </mat-optgroup>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="mb-2 w-100">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Data</mat-label>
          <input class="opacity-75" matInput readonly [value]="app.startedAt | date:'dd MMMM yyyy':'':'pl'"/>
        </mat-form-field>
      </div>
      <div class="d-flex flex-row gap-4 justify-content-center mb-4 w-100">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Godzina rozpoczęcia</mat-label>
          <input
            matInput
            [readonly] = "!editMode()"
            [formControl] ="controls.startedAt"
            [matTimepicker] ="startedAt"
            [matTimepickerMin] = "environmentVariables.startTime"
            [matTimepickerMax] = "environmentVariables.finishTime"
            class="custom-readonly"
          />
          @if (controls.startedAt.invalid) {
            <mat-error>{{ getErrorMessage(controls.startedAt) }}</mat-error>
          }
          <mat-timepicker-toggle matIconSuffix [for]="startedAt"/>
          <mat-timepicker #startedAt/>
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Godzina zakończenia</mat-label>
          <input
            matInput
            [readonly]="!editMode()"
            [formControl]="controls.finishedAt"
            [matTimepicker]="finishedAt"
            [matTimepickerMin] = "environmentVariables.startTime"
            [matTimepickerMax] = "environmentVariables.finishTime"
            class="custom-readonly"
          />
          @if (controls.finishedAt.invalid) {
            <mat-error>{{ getErrorMessage(controls.finishedAt) }}</mat-error>
          }
          <mat-timepicker-toggle matIconSuffix [for]="finishedAt"/>
          <mat-timepicker #finishedAt/>
        </mat-form-field>
      </div>

      <app-alert class="mt-3 w-75" *ngIf="errorMessage()" [text]="errorMessage()"></app-alert>

      <div class="row w-100 gap-2">
        <div *ngIf="!editMode()" class="col-sm text-center">
          <button mat-flat-button type="button" class="btn border w-100" (click)="goBack()">Powrót</button>
        </div>
        <div *ngIf="!editMode()" class="col-sm text-center">
          <button mat-flat-button type="button" class="btn btn-danger-custom w-100" (click)="removeSchedule()">Usuń grafik</button>
        </div>
        <div *ngIf="!editMode()" class="col-sm text-center">
          <button mat-flat-button type="button" class="btn text-white w-100" style="background-color: var(--primary-purple);" (click)="editSchedule()">Edytuj grafik</button>
        </div>
        <div *ngIf="editMode()" class="col-sm text-center">
          <button mat-flat-button type="button" class="btn border w-75" (click)="cancelEdit()">Anuluj</button>
        </div>
        <div *ngIf="editMode()" class="col-sm text-center">
          <button mat-flat-button type="button" class="btn text-white w-75" style="background-color: var(--primary-purple);" (click)="changeSchedule()" [disabled]="scheduleForm.invalid">Przełóż grafik</button>
        </div>
      </div>
    </form>
  </div>
</div>
