<div class="container-fluid d-flex flex-column align-items-center pt-3">
  <h2 class="text-center mb-4">
    Dodawanie grafiku jednodniowego
  </h2>
  <div class="col-12 col-sm-10 col-md-8 col-lg-6 p-4 mx-auto border rounded-2 bg-white">
    <form [formGroup]="scheduleForm" class="d-flex flex-column align-items-center">

      <div *ngIf="doctor() as doctor" class="mb-2 w-100">
        <app-doctor-card
          [id]="doctor.id"
          [name]="doctor.name"
          [surname]="doctor.surname"
          [specialization]="doctor.specializations[0].name"
          [profilePicture]="doctor.profilePicture"
          [mode]="'schedule'"
        />
      </div>

      <div class="mb-2 w-100">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Usługi</mat-label>
          <mat-select [formControl]="controls.services" multiple>
            @for (group of specializations; track group) {
              <mat-optgroup [label]="group.name">
                @for (services of group.services; track services) {
                  <mat-option [value]="services.id">{{services.name}}</mat-option>
                }
              </mat-optgroup>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="mb-2 w-100">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Data</mat-label>
          <input matInput [matDatepicker]="picker" [formControl]="controls.date" />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          @if (controls.date.invalid) {
            <mat-error>{{ getErrorMessage(controls.date) }}</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="d-flex flex-row gap-4 justify-content-center mb-4 w-100">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Godzina rozpoczęcia</mat-label>
          <input
            matInput
            [formControl] ="controls.startedAt"
            [matTimepicker] ="startedAt"
            [matTimepickerMin] = "environmentVariables.startTime"
            [matTimepickerMax] = "environmentVariables.finishTime"
          />
          @if (controls.startedAt.invalid) {
            <mat-error>{{ getErrorMessage(controls.startedAt) }}</mat-error>
          }
          <mat-timepicker-toggle matIconSuffix [for]="startedAt"/>
          <mat-timepicker #startedAt/>
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Godzina zakończenia</mat-label>
          <input
            matInput
            [formControl]="controls.finishedAt"
            [matTimepicker]="finishedAt"
            [matTimepickerMin] = "environmentVariables.startTime"
            [matTimepickerMax] = "environmentVariables.finishTime"
          />
          @if (controls.finishedAt.invalid) {
            <mat-error>{{ getErrorMessage(controls.finishedAt) }}</mat-error>
          }
          <mat-timepicker-toggle matIconSuffix [for]="finishedAt"/>
          <mat-timepicker #finishedAt/>
        </mat-form-field>
      </div>

      <app-alert class="mt-3 w-75" *ngIf="errorMessage()" [text]="errorMessage()"></app-alert>

      <div class="row w-100 gap-2">
        <div class="col-sm text-center">
          <button mat-flat-button type="button" class="btn border w-75" (click)="goBack()">Powrót</button>
        </div>
        <div class="col-sm text-center">
          <button mat-flat-button type="button" class="btn text-white w-75"  style="background-color: var(--primary-purple)" (click)="createSchedule()" [disabled]="scheduleForm.invalid">Utwórz grafik</button>
        </div>
      </div>
    </form>
  </div>
</div>
