<div class="container py-3" style="height: calc(100vh - 300px);">
  <div>
    <h3 class="text-center pt-3">Wiadomości</h3>
  </div>
  <div class="row h-100">

    <div class="card col-12 col-md-4 col-lg-3 p-2 h-100">
      <div *ngFor="let chat of chats()" class="card p-2 overflow-hidden mb-2 chat-group">

        <button
          type="button"
          class="list-group-item list-group-item-action d-flex align-items-center justify-content-between gap-2"
          (click)="selectChat(chat)"
          [class.active]="selectedChat()?.id === chat.id">

          <img
            *ngIf="!chat.profilePicture"
            [src]="chat.profilePicture"
            class="rounded-circle"
            width="40"
            height="40"
            alt="avatar">

          <span>{{ chat.name }} {{ chat.surname }}</span>

          <span
            *ngIf="isChatUnread(chat.id)"
            class="rounded-circle bg-danger d-inline-block pulse-dot"
            style="width: 12px; height: 12px; min-width: 12px;"
            title="Nowa wiadomość">
          </span>

        </button>

      </div>
    </div>

    <div *ngIf="selectedChat() as chat" class="col-12 col-md-8 col-lg-9 d-flex flex-column h-100">

      <div class="card py-2 px-3 mb-2 text-start">
        {{ chat.name }} {{ chat.surname }}
      </div>

      <div
        #messagesContainer
        class="card flex-grow-1 overflow-auto p-3 mb-2 bg-light"
        (scroll)="onScroll($event)">

        <div *ngIf="isLoadingMessages()" class="text-center mb-3">
          <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Ładowanie...</span>
          </div>
        </div>

        <div *ngIf="!hasMoreMessages() && messages().length > 0" class="text-center text-muted small mb-3">
          To początek konwersacji
        </div>

        <div *ngFor="let msg of messages()" class="mb-3 d-flex"
             [class.justify-content-end]="msg.authorId !== chat.id">

          <div
            class="p-2 rounded"
            [style.background-color]="msg.authorId !== chat.id ? 'var(--primary-purple)' : 'white'"
            [class.text-white]="msg.authorId !== chat.id"
            [class.bg-white]="msg.authorId === chat.id">

            <div class="small">{{ msg.text }}</div>
            <div class="text-end small"
                 [class.text-white]="msg.authorId !== chat.id"
                 [class.text-muted]="msg.authorId === chat.id">
              {{ msg.sentAt | date:'HH:mm' }}
            </div>
          </div>

        </div>

      </div>

      <div class="p-2">
        <form class="d-flex gap-2" (ngSubmit)="sendMessage()">

          <input
            autocomplete="off"
            type="text"
            class="form-control"
            placeholder="Treść wiadomości"
            [(ngModel)]="message"
            name="message"
          />

          <button class="btn btn-purple" type="submit">
            Wyślij
          </button>

        </form>
      </div>

    </div>
  </div>
</div>
