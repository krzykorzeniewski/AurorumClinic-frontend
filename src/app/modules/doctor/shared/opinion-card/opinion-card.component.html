<div class="card shadow-sm mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="d-flex align-items-center gap-2">
        <button *ngIf="isPatient$ | async" mat-icon-button [matMenuTriggerFor]="menuPatient" aria-label="opinion menu patient">
          <mat-icon>more_vert</mat-icon>
        </button>
                  <mat-menu #menuPatient="matMenu">
                    <button mat-menu-item (click)="editOpinion()">
                      <span>Edytuj opinię</span>
                    </button>
                    <button mat-menu-item (click)="deletePatientOpinion()">
                      <span>Usuń opinię</span>
                    </button>
                  </mat-menu>
        <button *ngIf="isDoctor$ | async" mat-icon-button [matMenuTriggerFor]="menuDoctor" aria-label="opinion menu doctor">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menuDoctor="matMenu">
          <button *ngIf="answer() === null" mat-menu-item (click)="createOpinionDoctor()">
            <span>Odpowiedz</span>
          </button>
          <button *ngIf="answer() !== null" mat-menu-item (click)="editOpinionDoctor()">
            <span>Edytuj odpowiedź</span>
          </button>
          <button *ngIf="answer() !== null" mat-menu-item (click)="deleteDoctorAnswer()">
            <span>Usuń odpowiedź</span>
          </button>
        </mat-menu>
        <button *ngIf="isAdmin$ | async" mat-icon-button [matMenuTriggerFor]="menuAdmin" aria-label="opinion menu admin">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menuAdmin="matMenu">
          <button mat-menu-item (click)="deletePatientOpinionByAdmin()">
            <span>Usuń opinię</span>
          </button>
        </mat-menu>

        <div>
          <h6 class="mb-1 fw-semibold">
            {{ patientName() }} {{ patientSurname() }} <span *ngIf="isPatient$ | async">(Ty)</span>
          </h6>
          <p class="mb-0 text-muted small">
            {{ createdAt() | date: 'd MMMM yyyy, HH:mm':'':'pl' }}
          </p>
        </div>
      </div>
      <div class="d-flex gap-1">
       <span *ngFor="let _ of [1,2,3,4,5]; let i = index">
          <mat-icon class="{{ i+1 <= +rating() ? 'text-warning' : 'text-secondary' }}">star</mat-icon>
        </span>
      </div>
    </div>

    <p class="mb-0">{{ comment() }}</p>

    <div *ngIf="answer()" class="mt-3 pt-3 border-top">
      <div class="d-flex align-items-start">
        <img [src]="doctorPicture()" alt="doctor-image" class="rounded me-3" style="width:50px; height:50px; object-fit: cover;">
        <div class="flex-grow-1">
          <h6 class="mb-0 fw-semibold">{{ doctorName() }} {{ doctorSurname() }}</h6>
          <p class="mb-2 text-muted small">{{ answeredAt() | date: 'd MMMM yyyy, HH:mm':'':'pl'   }}</p>
          <p class="mb-0">{{ answer() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>
